<div id="downloadModal" style="display: none;">
    <div class="modal-overlay">
        <div class="modal-content">
            <h3>Download File</h3>
            <div id="downloadDetails"></div>
            <div class="modal-actions">
                <button class="btn-primary" onclick="proceedDownload()">Download Now</button>
                <button class="btn-secondary" onclick="closeDownloadModal()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentDownloadOrder = null;

function openDownloadModal(order) {
    currentDownloadOrder = order;
    
    const details = document.getElementById('downloadDetails');
    details.innerHTML = `
        <div style="margin-bottom: 20px;">
            <p><strong>File:</strong> ${order.file_name}</p>
            <p><strong>Service:</strong> ${order.service_type}</p>
            <p><strong>Size:</strong> ${order.file_size ? (order.file_size / 1024 / 1024).toFixed(2) + ' MB' : 'Unknown'}</p>
            <p><strong>Status:</strong> ${order.status}</p>
        </div>
        <div style="background: #f3f4f6; padding: 12px; border-radius: 6px; font-size: 14px;">
            <p>üìù Download link will expire in 1 hour</p>
        </div>
    `;
    
    document.getElementById('downloadModal').style.display = 'block';
}

function closeDownloadModal() {
    document.getElementById('downloadModal').style.display = 'none';
    currentDownloadOrder = null;
}

async function proceedDownload() {
    if (!currentDownloadOrder) return;
    
    try {
        const response = await fetch(`/api/files/download/${currentDownloadOrder.id}`);
        if (response.ok) {
            const result = await response.json();
            // Open download URL in new tab
            window.open(result.download_url, '_blank');
            closeDownloadModal();
        } else {
            alert('Failed to generate download link.');
        }
    } catch (error) {
        alert('Download failed. Please try again.');
    }
}

// Close modal when clicking outside
document.getElementById('downloadModal').addEventListener('click', (e) => {
    if (e.target.id === 'downloadModal') {
        closeDownloadModal();
    }
});
</script>
